<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>ニコリヒトと伝説の泉 – プロトタイプ</title>
<style>
  html, body { margin:0; height:100%; background:#000; color:#fff; font-family:system-ui, -apple-system, "Segoe UI", Roboto, "ヒラギノ角ゴ ProN", "Noto Sans JP", sans-serif; }
  #game { display:block; background:#000; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
  addEventListener('resize', resize, {passive:true}); resize();

  const TILE = 32;
  const MAP_W = 15, MAP_H = 60;
  const player = {
    px: Math.floor(MAP_W/2)*TILE + TILE/2,
    py: (MAP_H-3)*TILE + TILE/2,
    speed: 36,
    img: new Image(),
    loaded: false
  };

  player.img.onload = () => {
    player.loaded = true;
  };
  player.img.src = './ニコリヒト.png'; // 確実に同じフォルダを参照

  function drawPlayer(){
    if (!player.loaded) return; // 読み込み完了前は描画しない
    const x = player.px - camera.x - TILE/2;
    const y = player.py - camera.y - TILE/2;
    ctx.drawImage(player.img, x, y, TILE, TILE);
  }

  const camera = { x:0, y:0, w:canvas.width, h:canvas.height };
  function updateCamera(){
    camera.w = canvas.width; camera.h = canvas.height;
    camera.x = Math.max(0, Math.min(player.px - camera.w/2, MAP_W*TILE - camera.w));
    camera.y = Math.max(0, Math.min(player.py - camera.h/2, MAP_H*TILE - camera.h));
  }

  function update(dt){ /* ゲーム更新処理 */ }
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawPlayer();
  }
  let last = performance.now()/1000;
  function loop(ms){
    const now = ms/1000, dt = now - last; last = now;
    update(dt); updateCamera(); draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
